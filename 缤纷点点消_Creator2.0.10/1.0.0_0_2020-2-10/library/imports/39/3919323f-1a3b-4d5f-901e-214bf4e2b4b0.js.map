{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\Game/assets\\script\\Game\\Game.js"],"names":["sdkConfig","require","Recorder","SNS","G","Util","cc","Class","extends","Component","properties","tilePre","default","type","Node","powerPre","AliveUI","Prefab","SuccessUI","scoreLabel","Label","scoreNum","timelabel","lvLabel","tileBg","videoBtnsNode","star1","AudioClip","star2","star3","star4","star5","star6","star7","star8","bgMusic","maxNum","isCal","onDestroy","audioEngine","stopMusic","onLoad","LieYingSDK","PolySDK","runSDK","sdk_key_tt","active","updateVideoBtnState","game","gametime","addtime","string","lv","combo","score","max","tiles","parent","powerBarBg","playMusic","hp","i","power","instantiate","addChild","gailv","Array","num","sum","length","row","col","tile","get","width","height","count","randomNum","arr","scanArr","Math","random","newNum","min","getComponent","setNum","setPosition","scanAround","setArrPosition","onStopRecorder","stop","bind","onStartRecorder","start","OnshareRecorder","shareVideo_tt","videoPath","isStart","children","lastRow","lastCol","isClear","undefined","indexOf","push","nextNum","parseInt","numLabel","curNum","addhp","runAction","scaleTo","operateLogic","touchRow","touchCol","isFirstCall","addScore","index","split","destoryTile","scheduleOnce","moveAllTileDown","playEffect","row1","moveTo","newTile","isSearch","gamesuccess","gameover","round","over","node","star","now","user","lvs","tempstar","save","home","director","loadScene","update","dt","last"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\Game","sourcesContent":["// var Colors = require(\"Colors\");\r\nvar sdkConfig = require(\"PolySDK\").sdkConfig;\r\nvar Recorder = require(\"PolySDK\").Recorder;\r\nvar SNS = require(\"SNS\");\r\nvar G = require(\"G\");\r\nvar Util = require(\"Util\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        tilePre: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        powerPre: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        // bg:{\r\n        //     default:null,\r\n        //     type:cc.Node\r\n        // },\r\n        // topBg:{\r\n        //     default:null,\r\n        //     type:cc.Node\r\n        // },\r\n\r\n        AliveUI: cc.Prefab,\r\n        SuccessUI: cc.Prefab,\r\n        // tiles: {\r\n        //     default: null,\r\n        //     type: Array\r\n        // },\r\n        // powers: {\r\n        //     default: null,\r\n        //     type: Array\r\n        // },\r\n        scoreLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        scoreNum: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        timelabel: cc.Label,\r\n        lvLabel: cc.Label,\r\n        tileBg: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        videoBtnsNode :cc.Node,\r\n        // powerBarBg: {\r\n        //     default: null,\r\n        //     type: cc.Node\r\n        // },\r\n        star1: cc.AudioClip,\r\n        star2: cc.AudioClip,\r\n        star3: cc.AudioClip,\r\n        star4: cc.AudioClip,\r\n        star5: cc.AudioClip,\r\n        star6: cc.AudioClip,\r\n        star7: cc.AudioClip,\r\n        star8: cc.AudioClip,\r\n        bgMusic: cc.AudioClip,\r\n        maxNum: 0,\r\n        isCal: false,\r\n    },\r\n    onDestroy: function () {\r\n        // 停止背景音乐\r\n        cc.audioEngine.stopMusic(this.bgMusic);\r\n    },\r\n    // use this for initialization\r\n    onLoad: function () {\r\n      \r\n        if (cc.LieYingSDK.PolySDK.sdkConfig.runSDK == cc.LieYingSDK.PolySDK.sdkConfig.sdk_key_tt) {\r\n            this.videoBtnsNode.active = true;\r\n            this.updateVideoBtnState();\r\n        } else {\r\n            this.videoBtnsNode.active = false;\r\n        }\r\n        G.game = this;\r\n\r\n        this.gametime = G.gametime + G.addtime;\r\n        G.addtime = 0;\r\n        this.lvLabel.string = \"Lv.\" + G.lv;\r\n        G.combo = 0;\r\n        this.score = 0;\r\n        this.max = G.lv * 500;\r\n   \r\n\r\n        this.scoreNum.string = this.score + \"/\" + this.max;\r\n\r\n        this.tiles = [];\r\n        this.tilePre.parent = null;\r\n        this.powerBarBg = this.powerPre.parent;\r\n        this.powerPre.parent = null;\r\n\r\n\r\n        // 播放背景音乐\r\n        cc.audioEngine.playMusic(this.bgMusic, true);\r\n        // 初始化方块数组\r\n        this.tiles = [\r\n            [null, null, null, null, null],\r\n            [null, null, null, null, null],\r\n            [null, null, null, null, null],\r\n            [null, null, null, null, null],\r\n            [null, null, null, null, null]\r\n        ];\r\n        // this.powers = [null, null, null, null, null];\r\n        // 背景层\r\n        // this.bg.width = cc.winSize.width;\r\n        // this.bg.height = cc.winSize.height;\r\n        // this.bg.setPosition(-cc.winSize.width/2,-cc.winSize.height/2);\r\n        // this.bg.color = Colors.gameBg;\r\n        // 顶部背景层\r\n        // this.topBg.width = cc.winSize.width-30;\r\n        // this.topBg.height = 100;\r\n        // this.topBg.setPosition(-cc.winSize.width/2+15,(cc.winSize.width-30)/2);\r\n        // 能量条背景层\r\n        // this.powerBarBg.width = cc.winSize.width-30;\r\n        // this.powerBarBg.height = this.powerBarBg.width/5/2;\r\n        // this.powerBarBg.setPosition(15-cc.winSize.width/2,this.topBg.y-200);\r\n        // this.powerBarBg.color = Colors.powerBarBg;\r\n        // 方块背景层\r\n\r\n        // this.tileBg.width = cc.winSize.width-30;\r\n        // this.tileBg.height = this.tileBg.width;\r\n        // this.tileBg.setPosition(15-cc.winSize.width/2,this.powerBarBg.y-10-this.tileBg.height);\r\n        // this.tileBg.color = Colors.tileBg;\r\n        this.hp = 5;\r\n        // 生成能量条\r\n        for (var i = 0; i < 5; i++) {\r\n            var power = cc.instantiate(this.powerPre);\r\n            // power.width = (this.powerBarBg.width-30)/5;\r\n            // power.height = this.powerBarBg.height-10;\r\n            this.powerBarBg.addChild(power);\r\n            // power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\r\n            // power.color = Colors.power;\r\n            // this.powers[i] = power;\r\n        };\r\n        // 计算生成方块数字的概率\r\n        var gailv = new Array();\r\n        this.maxNum = 8;\r\n        for (var num = 0; num < this.maxNum - 3; num++) {\r\n            gailv[num] = this.maxNum - 3 - num;\r\n        }\r\n        var sum = 0;\r\n        for (var num = 0; num < gailv.length; num++) {\r\n            sum += gailv[num];\r\n        }\r\n        // 生成初始方块\r\n        for (var row = 0; row < 5; row++) {\r\n            for (var col = 0; col < 5; col++) {\r\n                var tile = G.get(\"tile\");\r\n                if (tile == null) {\r\n                    tile = cc.instantiate(this.tilePre);\r\n                }\r\n\r\n                // tile.getComponent(\"Tile\").game = this;\r\n                tile.width = (this.tileBg.width - 30) / 5;\r\n                tile.height = (this.tileBg.height - 30) / 5;\r\n                var count = 0;\r\n                // var maxRandom = 8;\r\n                var randomNum = 0;\r\n                while (true) {\r\n                    count++;\r\n                    var arr = new Array();\r\n                    var scanArr = new Array();\r\n                    // if(count>10){\r\n                    //     maxRandom++;\r\n                    // }\r\n                    // randomNum = Math.ceil(Math.random()*maxRandom);\r\n                    randomNum = Math.random() * sum;\r\n                    var newNum = 0;\r\n                    var min = 0;\r\n                    for (var num = 0; num < gailv.length; num++) {\r\n                        if (randomNum >= min && randomNum <= min + gailv[num]) {\r\n                            newNum = num + 1;\r\n                            break;\r\n                        } else {\r\n                            min = min + gailv[num];\r\n                        }\r\n                    }\r\n                    tile.getComponent(\"Tile\").setNum(newNum, false, false);\r\n                    tile.setPosition(5 + (5 + tile.width) * col + tile.width / 2, 5 + (5 + tile.height) * row + tile.height / 2);\r\n                    this.tiles[row][col] = tile;\r\n                    this.scanAround(row, col, -1, -1, newNum, arr, scanArr);\r\n                    if (arr.length < 3) {\r\n                        break;\r\n                    }\r\n                }\r\n                tile.getComponent(\"Tile\").setArrPosition(row, col);\r\n                this.tileBg.addChild(tile);\r\n            }\r\n        }\r\n    },\r\n\r\n    //------------------------------------------------------------- TT录屏\r\n\r\n    //停止按钮 响应事件\r\n    onStopRecorder() {\r\n        cc.LieYingSDK.PolySDK.Recorder.stop(this.updateVideoBtnState.bind(this));\r\n    },\r\n    //开始按钮 响应事件\r\n    onStartRecorder() {\r\n        cc.LieYingSDK.PolySDK.Recorder.start(this.updateVideoBtnState.bind(this));\r\n    },\r\n    //分享按钮  响应事件\r\n    OnshareRecorder() {\r\n        cc.LieYingSDK.PolySDK.Recorder.shareVideo_tt(cc.LieYingSDK.PolySDK.Recorder.videoPath);\r\n        this.updateVideoBtnState();\r\n    },\r\n\r\n    //更新按钮状态，\r\n    //其中  children[0]为  开始按钮 node 节点\r\n    //     children[1]为  停止按钮 node 节点 \r\n    updateVideoBtnState: function () {\r\n\r\n        if (cc.LieYingSDK.PolySDK.Recorder.videoPath == null) {\r\n            if (cc.LieYingSDK.PolySDK.Recorder.isStart) {\r\n                this.videoBtnsNode.children[0].active = false;\r\n                this.videoBtnsNode.children[1].active = true;\r\n                this.videoBtnsNode.children[2].active = false;\r\n            } else {\r\n                this.videoBtnsNode.children[0].active = true;\r\n                this.videoBtnsNode.children[1].active = false;\r\n                this.videoBtnsNode.children[2].active = false;\r\n            }\r\n        } else {\r\n            this.videoBtnsNode.children[0].active = false;\r\n            this.videoBtnsNode.children[1].active = false;\r\n            this.videoBtnsNode.children[2].active = true;\r\n        }\r\n    },\r\n    //------------------------------------------------------------- TT结束\r\n\r\n    /*\r\n     * 核心扫描逻辑\r\n     * @param row 指定行\r\n     * @param col 指定列\r\n     * @param lastRow 上次扫描的行\r\n     * @param lastCol 上次扫描的列\r\n     * @param num 扫描要比对的数字\r\n     * @param arr 记录数字相同且彼此相邻的数组\r\n     * @param scanArr 记录扫描过的点的数组\r\n     */\r\n    scanAround: function (row, col, lastRow, lastCol, num, arr, scanArr) {\r\n        // cc.log(\"row:\",row,\",col:\",col,\",lastRow:\",lastRow,\",lastCol:\",lastCol,\",num:\",num,\",arr:\",arr,\",scanArr:\",scanArr);\r\n        if (this.tiles[row][col] == null) {\r\n            return;\r\n        }\r\n        var isClear = false;\r\n        if (scanArr == undefined) {\r\n            scanArr = new Array();\r\n        }\r\n        // 扫描过的节点不再扫描\r\n        if (scanArr.indexOf(row + \"#\" + col) == -1) {\r\n            scanArr.push(row + \"#\" + col);\r\n        } else {\r\n            return;\r\n        }\r\n        // 扫描上\r\n        if (row < 4 && (lastRow != (row + 1) || lastCol != col) && this.tiles[row + 1][col] != null) {\r\n            var nextNum = parseInt(this.tiles[row + 1][col].getComponent(\"Tile\").numLabel.string);\r\n            if (nextNum == num) {\r\n                if (arr.indexOf(row + \"#\" + col) == -1) {\r\n                    arr.push(row + \"#\" + col);\r\n                }\r\n                this.scanAround(row + 1, col, row, col, num, arr, scanArr);\r\n                isClear = true;\r\n            }\r\n        }\r\n        // 扫描下\r\n        if (row > 0 && (lastRow != (row - 1) || lastCol != col) && this.tiles[row - 1][col] != null) {\r\n            var nextNum = parseInt(this.tiles[row - 1][col].getComponent(\"Tile\").numLabel.string);\r\n            if (nextNum == num) {\r\n                if (arr.indexOf(row + \"#\" + col) == -1) {\r\n                    arr.push(row + \"#\" + col);\r\n                }\r\n                this.scanAround(row - 1, col, row, col, num, arr, scanArr);\r\n                isClear = true;\r\n            }\r\n        }\r\n        // 扫描左\r\n        if (col > 0 && (lastRow != row || lastCol != (col - 1)) && this.tiles[row][col - 1] != null) {\r\n            var nextNum = parseInt(this.tiles[row][col - 1].getComponent(\"Tile\").numLabel.string);\r\n            if (nextNum == num) {\r\n                if (arr.indexOf(row + \"#\" + col) == -1) {\r\n                    arr.push(row + \"#\" + col);\r\n                }\r\n                this.scanAround(row, col - 1, row, col, num, arr, scanArr);\r\n                isClear = true;\r\n            }\r\n        }\r\n        // 扫描右\r\n        if (col < 4 && (lastRow != row || lastCol != (col + 1)) && this.tiles[row][col + 1] != null) {\r\n            var nextNum = parseInt(this.tiles[row][col + 1].getComponent(\"Tile\").numLabel.string);\r\n            if (nextNum == num) {\r\n                if (arr.indexOf(row + \"#\" + col) == -1) {\r\n                    arr.push(row + \"#\" + col);\r\n                }\r\n                this.scanAround(row, col + 1, row, col, num, arr, scanArr);\r\n                isClear = true;\r\n            }\r\n        }\r\n        // 四周都不通，但不是出发遍历点，并且数字相同，也加入到数组\r\n        if (!isClear && (lastRow != -1 && lastCol != -1)) {\r\n            var curNum = parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string)\r\n            if (curNum == num) {\r\n                if (arr.indexOf(row + \"#\" + col) == -1) {\r\n                    arr.push(row + \"#\" + col);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    addhp() {\r\n        if (this.hp >= 5) {\r\n            return;\r\n        }\r\n\r\n        this.hp++;\r\n\r\n        var power = cc.instantiate(this.powerPre);\r\n        // power.width = (this.powerBarBg.width-30)/5;\r\n        // power.height = this.powerBarBg.height-10;\r\n        this.powerBarBg.addChild(power);\r\n        // power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\r\n        // power.color = Colors.power;\r\n        // power.setScale(0);\r\n        power.runAction(cc.scaleTo(0.1, 1));\r\n    },\r\n    // 主要操作逻辑\r\n    operateLogic: function (touchRow, touchCol, curNum, isFirstCall) {\r\n        var arr = new Array();\r\n        var scanArr = new Array();\r\n        this.scanAround(touchRow, touchCol, -1, -1, curNum, arr, scanArr);\r\n        if (arr.length >= 3) {\r\n            var addScore = 0;\r\n            for (var index in arr) {\r\n                var row = arr[index].split(\"#\")[0];\r\n                var col = arr[index].split(\"#\")[1];\r\n                addScore += parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string * 10);\r\n                if (row != touchRow || col != touchCol) {\r\n                    // 执行销毁动作                    \r\n                    this.tiles[row][col].getComponent(\"Tile\").destoryTile();\r\n                    this.tiles[row][col] = null;\r\n                } else {\r\n                    this.tiles[row][col].getComponent(\"Tile\").setNum(curNum + 1, false, true);\r\n                    this.maxNum = curNum + 1 > this.maxNum ? curNum + 1 : this.maxNum;\r\n                }\r\n            }\r\n            // 更新分数\r\n            this.score += addScore;\r\n            this.scoreNum.string = this.score + \"/\" + this.max;\r\n\r\n            // G.tip(\"+\"+addScore);\r\n\r\n            this.scheduleOnce(function () {\r\n                // 0.1s后所有方块向下移动\r\n                this.moveAllTileDown();\r\n            }, 0.1);\r\n            if (!isFirstCall) {\r\n                // 能量条补充一格\r\n                // for (var i = 0; i < 5; i++) {\r\n                //     if (this.powers[i] == null) {\r\n                //         var power = cc.instantiate(this.powerPre);\r\n                //         // power.width = (this.powerBarBg.width-30)/5;\r\n                //         // power.height = this.powerBarBg.height-10;\r\n                //         this.powerBarBg.addChild(power);\r\n                //         // power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\r\n                //         power.color = Colors.power;\r\n                //         // power.setScale(0);\r\n                //         power.runAction(cc.scaleTo(0.1, 1));\r\n                //         this.powers[i] = power;\r\n                //         break;\r\n                //     }\r\n                // };\r\n\r\n                this.addhp();\r\n                // this.hp++;\r\n\r\n                // var power = cc.instantiate(this.powerPre);\r\n                // // power.width = (this.powerBarBg.width-30)/5;\r\n                // // power.height = this.powerBarBg.height-10;\r\n                // this.powerBarBg.addChild(power);\r\n                // // power.setPosition(5+(5+power.width)*i+power.width/2,5+power.height/2);\r\n                // power.color = Colors.power;\r\n                // // power.setScale(0);\r\n                // power.runAction(cc.scaleTo(0.1, 1));\r\n                // // this.powers[i] = power;\r\n\r\n            }\r\n            // 连击次数+1\r\n            G.combo++;\r\n            // cc.log(\"连击次数：\"+G.combo);\r\n            // 播放音效\r\n            switch (G.combo) {\r\n                case 1:\r\n                    cc.audioEngine.playEffect(this.star1);\r\n                    break;\r\n                case 2:\r\n                    cc.audioEngine.playEffect(this.star2);\r\n                    break;\r\n                case 3:\r\n                    cc.audioEngine.playEffect(this.star3);\r\n                    break;\r\n                case 4:\r\n                    cc.audioEngine.playEffect(this.star4);\r\n                    break;\r\n                case 5:\r\n                    cc.audioEngine.playEffect(this.star5);\r\n                    break;\r\n                case 6:\r\n                    cc.audioEngine.playEffect(this.star6);\r\n                    break;\r\n                case 7:\r\n                    cc.audioEngine.playEffect(this.star7);\r\n                    break;\r\n                case 8:\r\n                    cc.audioEngine.playEffect(this.star8);\r\n                    break;\r\n                default:\r\n                    cc.audioEngine.playEffect(this.star8);\r\n                    break;\r\n            }\r\n            this.isCal = true;\r\n\r\n\r\n\r\n            return true;\r\n        } else {\r\n            this.isCal = false;\r\n\r\n\r\n\r\n            return false;\r\n        }\r\n\r\n    },\r\n    // 所有方块向下移动\r\n    moveAllTileDown: function () {\r\n        for (var col = 0; col < 5; col++) {\r\n            for (var row = 0; row < 5; row++) {\r\n                if (this.tiles[row][col] != null) { // 有方块\r\n                    for (var row1 = row; row1 > 0; row1--) {\r\n                        if (this.tiles[row1 - 1][col] == null) {\r\n                            //如果没有向下移动\r\n                            this.tiles[row1 - 1][col] = this.tiles[row1][col];\r\n                            this.tiles[row1][col] = null;\r\n                            this.tiles[row1 - 1][col].getComponent(\"Tile\").moveTo(row1 - 1, col);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.scheduleOnce(function () {\r\n            // 计算生成方块数字的概率\r\n            var gailv = new Array();\r\n            // for(var num = 0;num<this.maxNum;num++){\r\n            //     gailv[num] = 0;\r\n            // }\r\n            for (var num = 0; num < this.maxNum - 3; num++) {\r\n                gailv[num] = this.maxNum - 3 - num;\r\n            }\r\n            // for(var num = 0;num<this.maxNum;num++){\r\n            //     for (var col = 0; col < 5; col++) {\r\n            //         for (var row = 0; row < 5; row++) {\r\n            //             if(this.tiles[row][col]!=null&&parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string)==num+1){\r\n            //                 gailv[num]+=1;\r\n            //             }\r\n            //         }\r\n            //     }\r\n            // }\r\n            var sum = 0;\r\n            for (var num = 0; num < gailv.length; num++) {\r\n                sum += gailv[num];\r\n            }\r\n            // 0.3s后生成新方块\r\n            for (var col = 0; col < 5; col++) {\r\n                for (var row = 0; row < 5; row++) {\r\n                    if (this.tiles[row][col] == null) {\r\n                        var tile = cc.instantiate(this.tilePre);\r\n                        tile.width = (this.tileBg.width - 30) / 5;\r\n                        tile.height = (this.tileBg.height - 30) / 5;\r\n                        // var maxRandom = this.maxNum;\r\n                        // var randomNum = Math.ceil(Math.random()*maxRandom);\r\n                        var randomNum = Math.random() * sum;\r\n                        var newNum = 0;\r\n                        var min = 0;\r\n                        for (var num = 0; num < gailv.length; num++) {\r\n                            if (randomNum >= min && randomNum <= min + gailv[num]) {\r\n                                newNum = num + 1;\r\n                                break;\r\n                            } else {\r\n                                min = min + gailv[num];\r\n                            }\r\n                        }\r\n                        tile.getComponent(\"Tile\").setNum(newNum, false, false);\r\n                        tile.getComponent(\"Tile\").newTile(row, col);\r\n                        this.tiles[row][col] = tile;\r\n                        this.tileBg.addChild(tile);\r\n                    }\r\n                }\r\n            }\r\n            // 0.5s后遍历执行逻辑\r\n            this.scheduleOnce(function () {\r\n                var isSearch = false;\r\n                for (var col = 0; col < 5; col++) {\r\n                    for (var row = 0; row < 5; row++) {\r\n                        if (!isSearch) {\r\n                            isSearch = this.tiles[row][col] != null && this.operateLogic(row, col, parseInt(this.tiles[row][col].getComponent(\"Tile\").numLabel.string), false);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (!isSearch) {\r\n                    if (this.score >= this.max) {\r\n                        this.gamesuccess();\r\n                    }\r\n                }\r\n\r\n            }, 0.5);\r\n        }, 0.3);\r\n    },\r\n\r\n    gameover() {\r\n       // Recorder.end(this.updateVideoBtnState.bind(this));\r\n        this.gametime = Math.round(this.gametime);\r\n        this.over = true;\r\n        let node = cc.instantiate(this.AliveUI);\r\n        node.parent = this.node;\r\n    },\r\n    gamesuccess() {\r\n       // Recorder.end(this.updateVideoBtnState.bind(this));\r\n        this.gametime = Math.round(this.gametime);\r\n        this.over = true;\r\n\r\n\r\n\r\n        this.gametime = Math.round(this.gametime);\r\n\r\n\r\n        let star = 1;\r\n        if (this.gametime > 40) {\r\n            star = 3;\r\n        } else if (this.gametime > 20) {\r\n            star = 2;\r\n        }\r\n\r\n        // G.user.lv = Math.max(G.user.lv, G.lv + 1); //新的一关\r\n\r\n        let now = G.user.lvs[G.lv];\r\n        if (star > now) {\r\n            G.user.lvs[G.lv] = star;\r\n        }\r\n\r\n        if (G.lv + 1 > G.user.lv) { //新的一关\r\n            G.user.lv = G.lv + 1; //新的一关\r\n            G.user.lvs[G.lv + 1] = 0;\r\n            G.user.star += star - now;\r\n        } else {\r\n\r\n        }\r\n        G.tempstar = star;\r\n        G.save();\r\n\r\n\r\n        let node = cc.instantiate(this.SuccessUI);\r\n        node.parent = this.node;\r\n\r\n    },\r\n    home() {\r\n        cc.director.loadScene(\"Home\");\r\n    },\r\n    // called every frame, uncomment this function to activate update callback\r\n    update(dt) {\r\n\r\n\r\n        if (this.over) {\r\n            return;\r\n        }\r\n        this.gametime -= dt;\r\n\r\n        this.now = Math.round(this.gametime);\r\n\r\n        if (this.now != this.last) {\r\n            this.last = this.now;\r\n            this.timelabel.string = this.now;\r\n        }\r\n\r\n        if (this.gametime <= 0) {\r\n\r\n\r\n            this.gameover();\r\n        }\r\n    }\r\n});"]}