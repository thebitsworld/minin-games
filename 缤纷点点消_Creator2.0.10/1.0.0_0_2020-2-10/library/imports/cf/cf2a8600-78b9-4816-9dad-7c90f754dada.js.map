{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\Common/assets\\script\\Common\\SNS.js"],"names":["Share","require","VideoAd","BannerAd","G","SNS","load","loaded","cc","log","res","wx","getLaunchOptionsSync","query","uid","error","showShareMenu","withShareTicket","width","winSize","height","onShareAppMessage","netConfig","shares","q","Math","floor","random","length","imageUrlId","imageUrl","title","game","canvas","toTempFilePathSync","x","y","destWidth","destHeight","on","EVENT_HIDE","sharesuccess","shareStartTime","Date","EVENT_SHOW","shareing","time","getTime","sharefail","e","createBannerAd","showAD","forcead","showBannerAd","hideAD","hideBannerAd","showVideo","success","fail","LieYingSDK","PolySDK","platformEventCallback","vidioEventCallback","bind","shareEventCallback","otherEventCallback","createRewardedVideoAd","award","share","msg","shareLocal","Tip","show","easy","showbbs","btn","createGameClubButton","icon","style","left","top","hidebbs","hide","submit","type","score","window","postMessage","messageType","MAIN_MENU_NUM","module","exports"],"mappings":"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","file":"SNS.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\Common","sourcesContent":["var Share = require(\"PolySDK\").Share;\r\nvar VideoAd = require(\"PolySDK\").VideoAd;\r\nvar BannerAd = require(\"PolySDK\").BannerAd;\r\nvar G = require(\"G\");\r\nvar SNS = {\r\n\r\n    load() {\r\n\r\n        if (this.loaded) {\r\n            return;\r\n        }\r\n        this.loaded = true;\r\n\r\n        cc.log(\"验证分享\");\r\n        try {\r\n\r\n            let res = wx.getLaunchOptionsSync();\r\n            if (res && res.query && res.query.uid) {\r\n                cc.log(\"成功邀请了！！！！！！！！query:\" + res.query.uid);\r\n            }\r\n        } catch (error) {\r\n            cc.error(error);\r\n        }\r\n\r\n        //监听\r\n        cc.log(\"开始监听share\");\r\n        try {\r\n\r\n\r\n            wx.showShareMenu({\r\n                withShareTicket: true,\r\n            });\r\n\r\n            let width = cc.winSize.width;\r\n            let height = cc.winSize.height;\r\n\r\n\r\n            wx.onShareAppMessage(() => {\r\n                if (G.netConfig.wx.shares) {\r\n                    let q = G.netConfig.wx.shares[Math.floor(Math.random() * G.netConfig.wx.shares.length)];\r\n                    return {\r\n                        imageUrlId: q.imageUrlId,\r\n                        imageUrl: q.imageUrl,\r\n\r\n                        title: q.title,\r\n                        query: \"uid=\" + G.uid,\r\n                    }\r\n                }\r\n\r\n\r\n\r\n                return {\r\n                    // imageUrlId: \"OLRfZ2qySCmU3adcFZLBkw\",\r\n                    // imageUrl: \"https://mmocgame.qpic.cn/wechatgame/gKwCzR9cWiaLafIqY6u3q4mnf0KnicfuqLnib7WpBwavU9j77w2QeRKGF25PBoiankZy/0\",\r\n\r\n                    title: \"根本停不下来！！\",\r\n                    query: \"uid=\" + G.uid,\r\n                    imageUrl: cc.game.canvas.toTempFilePathSync({\r\n                        x: 0,\r\n                        y: 0,\r\n                        width: width,\r\n                        height: height,\r\n                        destWidth: width,\r\n                        destHeight: height\r\n                    }),\r\n                }\r\n\r\n\r\n\r\n            });\r\n\r\n        } catch (error) {\r\n            cc.error(error);\r\n        }\r\n\r\n        try {\r\n\r\n\r\n            cc.log(\"监听EVENT_SHOW\");\r\n            cc.game.on(cc.game.EVENT_HIDE, () => {\r\n                cc.log(\"触发EVENT_HIDE\");\r\n                if (!this.sharesuccess) {\r\n                    return;\r\n                }\r\n\r\n                cc.log(\"检测到EVENT_HIDE\");\r\n\r\n                this.shareStartTime = new Date();\r\n            }, this);\r\n\r\n            cc.game.on(cc.game.EVENT_SHOW, () => {\r\n                cc.log(\"触发EVENT_SHOW\");\r\n                if (!this.sharesuccess) {\r\n                    return;\r\n                }\r\n                this.shareing = false;\r\n\r\n\r\n                cc.log(\"检测到EVENT_SHOW\");\r\n\r\n                let time = new Date().getTime() - this.shareStartTime.getTime();\r\n\r\n                cc.log(\"超过3秒才算成功,分享间隔时间ms:\" + time);\r\n                if (time > 3000) { //\r\n                    cc.log('分享成功')\r\n                    this.sharesuccess();\r\n                } else {\r\n                    cc.log('分享失败')\r\n                    this.sharefail();\r\n                }\r\n                this.sharesuccess = null;\r\n\r\n            }, this);\r\n        } catch (e) {\r\n            cc.error(e);\r\n\r\n        }\r\n    },\r\n\r\n    createBannerAd(){\r\n        BannerAd.createBannerAd();\r\n    },\r\n\r\n    showAD(forcead) { //显示横幅广告\r\n        BannerAd.showBannerAd();\r\n    },\r\n\r\n    hideAD() { //关闭横幅广告\r\n        BannerAd.hideBannerAd();\r\n    },\r\n\r\n    showVideo(success, fail) { //显示视频\r\n\r\n        cc.LieYingSDK.PolySDK.platformEventCallback(vidioEventCallback.bind(this),\r\n            shareEventCallback.bind(this),\r\n            otherEventCallback.bind(this));\r\n        function vidioEventCallback() {\r\n            //广告UI   广告回调\r\n            //这需要调用sdk中的 广告相关的代码\r\n            VideoAd.createRewardedVideoAd(success, fail);\r\n        }\r\n        function shareEventCallback() {\r\n            //分享UI   分享回调\r\n            //这需要调用sdk中的 分享相关的代码\r\n            success();\r\n        }\r\n        function otherEventCallback() {\r\n            //正常UI   正常回调\r\n            success();\r\n        }\r\n\r\n\r\n        //VideoAd.createRewardedVideoAd(success, fail);\r\n    },\r\n\r\n\r\n    award(success, fail) {\r\n    },\r\n\r\n\r\n\r\n\r\n    share(msg, success, fail) {\r\n        Share.share()\r\n\r\n    },\r\n    shareLocal(msg, success, fail) {\r\n        try {\r\n\r\n            this.shareing = true;\r\n            this.sharesuccess = success;\r\n            this.sharefail = fail;\r\n            Share.share();\r\n            /*wx.shareAppMessage({\r\n                title: msg,\r\n\r\n                imageUrl: canvas.toTempFilePathSync({\r\n                    destWidth: 500,\r\n                    destHeight: 400\r\n                }),\r\n\r\n                query: \"uid=\" + G.uid,\r\n            });*/\r\n\r\n        } catch (e) {\r\n            cc.error(e);\r\n            G.Tip.show(\"分享出错\");\r\n            if (G.netConfig.wx.easy) {\r\n                success();\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    showbbs() { //微信游戏圈论坛\r\n        try {\r\n            this.btn = wx.createGameClubButton({\r\n                icon: 'green',\r\n                style: {\r\n                    left: 10,\r\n                    top: 45,\r\n                    width: 30,\r\n                    height: 30,\r\n                }\r\n            });\r\n            this.btn.show();\r\n        } catch (e) {\r\n            cc.error(e);\r\n        }\r\n\r\n    },\r\n\r\n    hidebbs() {\r\n        try {\r\n            this.btn.hide();\r\n        } catch (e) {\r\n            cc.error(e);\r\n        }\r\n    },\r\n\r\n\r\n    submit(type, score) {\r\n        return;\r\n        try {\r\n            if (window.wx) {\r\n                cc.log(\"提交分数\");\r\n                wx.postMessage({\r\n                    messageType: 3,\r\n                    MAIN_MENU_NUM: type,\r\n                    score: score,\r\n                });\r\n            }\r\n        } catch (e) {\r\n            cc.error(e);\r\n        }\r\n    }\r\n\r\n};\r\nmodule.exports = SNS;"]}