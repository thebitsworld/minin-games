{"version":3,"sources":["GameRecorderManager.js"],"names":["G","require","cc","Class","extends","Component","properties","recorder","duration","isStart","isCanOverVideo","minVideoTime","tips","onLoad","self","init","tt","console","log","getGameRecorderManager","clipIndexList","onError","errMsg","onResume","onPause","onStart","node","children","active","scheduleOnce","onStop","res","videoPath","clipVideo","path","timeRange","success","shareVideo","fail","e","error","startVideoClick","Tip","show","start","stopVideoClick","stop","startAndstopClick"],"mappings":"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","file":"GameRecorderManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\Common","sourcesContent":["var G = require(\"G\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        recorder : null,\r\n        duration : 300,\r\n        isStart  : false,\r\n        isCanOverVideo : false,//是否可以结束录制\r\n        minVideoTime : 5,// 单位 s\r\n        tips : \"录制时间最少5秒哦！\"\r\n    },\r\n    onLoad(){\r\n        let self = this;\r\n\r\n        self.init();\r\n    },\r\n    //初始化接口\r\n    init() {\r\n        let self = this;\r\n        if (typeof (tt) != \"undefined\"){\r\n\r\n            if(!self.recorder){\r\n                console.log(\"self.recorder\");\r\n                self.recorder = tt.getGameRecorderManager();\r\n            }\r\n           \r\n\r\n            self.clipIndexList = []; // 剪辑索引列表\r\n\r\n            self.recorder.onError(function(errMsg){\r\n                console.log('录屏错误 ：'+ errMsg);\r\n            })\r\n\r\n            self.recorder.onResume(errMsg =>{\r\n                console.log('录屏继续');\r\n                // do somethine;\r\n            })\r\n\r\n            self.recorder.onPause(errMsg =>{\r\n                console.log('录屏暂停');\r\n                // do somethine;\r\n            })\r\n\r\n            self.recorder.onStart(res =>{\r\n                console.log('录屏开始');\r\n                self.isStart = true;\r\n                self.isCanOverVideo = false;\r\n                self.node.children[0].active = false;\r\n                self.node.children[1].active = true;\r\n                self.scheduleOnce(function(){\r\n                    self.isCanOverVideo = true;\r\n                },self.minVideoTime)\r\n            })\r\n\r\n            self.recorder.onStop((res)=>{\r\n                // stop 之后调用表示裁剪录屏中的最后10s\r\n                console.log(\"录屏结束 ：\"+res.videoPath);\r\n                self.isStart = false;\r\n                self.isCanOverVideo = false;\r\n                self.node.children[0].active = true;\r\n                self.node.children[1].active = false;\r\n                self.recorder.clipVideo({\r\n                    path: res.videoPath,\r\n                    timeRange: [self.duration, 0],\r\n                    success(res){\r\n                      console.log(\"clipVideo  success\");\r\n                      console.log(res.videoPath); // 生成最后10秒的视频\r\n                      self.shareVideo(res.videoPath);\r\n                    },\r\n                    fail(e) {\r\n                      console.log(\"clipVideo  fail\");\r\n                      console.error(e)\r\n                    }\r\n                  })\r\n    \r\n            })\r\n\r\n        }\r\n\r\n    }, \r\n\r\n    startVideoClick(){\r\n        const self = this;\r\n        if(!self.recorder)return;\r\n        if(self.isStart ){\r\n            G.Tip.show(self.tips)\r\n        }else{\r\n            self.recorder.start({duration: self.duration,})\r\n        }\r\n       \r\n     \r\n    },\r\n\r\n    stopVideoClick: function () {\r\n        const self = this;\r\n        if(!self.recorder)return;\r\n        console.log(\"stopVideoClick\");\r\n        self.isCanOverVideo?self.recorder.stop():G.Tip.show(self.tips);\r\n    },\r\n\r\n    startAndstopClick: function(e){\r\n        const self = this;\r\n        if(!self.isCanOverVideo){\r\n            self.startVideoClick();\r\n         }else{\r\n            self.stopVideoClick();\r\n         }\r\n    },\r\n\r\n    shareVideo : function(videoPath){\r\n        const self = this;\r\n        if (typeof (tt) != \"undefined\"){\r\n            tt.shareVideo({\r\n                videoPath : videoPath,\r\n                success(res){\r\n                    console.log(\"分享视频成功\");\r\n                },\r\n                fail(e) {\r\n                    console.log(\"分享视频失败\");\r\n                    if(e.errMsg == \"shareVideo:fail cancel\")return;\r\n                    //console.error(e)\r\n                    G.Tip.show(self.tips)\r\n                }\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n});"]}